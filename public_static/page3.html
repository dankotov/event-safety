<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="stylesheet" type="text/css" href="./public/styles/navbar.css">
	<link rel="stylesheet" type="text/css" href="./public/styles/style3.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.0/themes/prism.min.css" />
	<title>CPS530 Term Project</title>
</head>

<body>
	<nav>
		<div>
			<ul class="nav-links" id="default">
				<li><a href="./index.html">Page 1</a></li>
				<li><a href="./page2.html">Page 2</a></li>
				<li><a href="./page3.html" id="current-page">Page 3</a></li>
				<li><a href="./page4.html">Page 4</a></li>
				<li><a href="./page5.html">Page 5</a></li>
				<li><a href="./page6.html">Page 6</a></li>
			</ul>
		</div>
		<div class="page-selector">
			<button class="dropbtn">
				<p>Select Page <span id="arrow-drop">&#9654&#xFE0E;</span></p>
			</button>
			<div class="drop-content">
				<div id="hidden" class="nav-links disabled">
					<a href="./index.html">Page 1</a>
					<a href="./page2.html">Page 2</a>
					<a href="./page3.html" id="current-page">Page 3</a>
					<a href="./page4.html">Page 4</a>
					<a href="./page5.html">Page 5</a>
					<a href="./page6.html">Page 6</a>
				</div>
			</div>
		</div>
	</nav>

	<!-- YOUR CODE STARTS HERE -->

	<center class="outer-div">
		<div class="mid-div">
			<div class="center-div">
					<section class="section-info">
						<h1 class="section-title">Front-end tutorial</h1>

						<p>First, we need to define map component in the front-end folder. To do so, we need to install a map
							library for React:</p>
						<pre>npm install leaflet</pre>
						<p>Next, we have to create a <em>.js</em> file for Map component inside working directory. After that, we
							can start
							writing code for our map component:</p>
						<pre>
							<code>
								import React from 'react';
								import L from 'leaflet';
								import 'leaflet/dist/leaflet.css';
								
								const Wrapper = styled.div`
								  width: ${props => props.width};
								  height: ${props => props.height};
								`;
								
								export default class Map extends React.Component {
								
								  componentDidMount() {
								
									this.map = L.map('map', {
									  center: [43.657998, -79.378355],
									  zoom: 17,
									  zoomControl: false
									});
								
									L.tileLayer('https://{s}.tile.openstreetmap.se/hydda/full/{z}/{x}/{y}.png', {
									  detectRetina: true,
									  maxZoom: 20,
									  maxNativeZoom: 17,
									}).addTo(this.map);
								  }
								
								  render() {
									return &lt;Wrapper width="100%" height="600px" id="map" /&gt;
								  }
								}
							</code>
						</pre>
						<p>First, we import libraries, such as React and Leafmap into the file. Then, we apply CSS stylings for
							height and width of a map. We now moving to creating a component Map that generated a new map.
							<em>ComponentDidMount()</em> will generate a new map once Map component is loaded. By default, center
							point is at
							<em>[43.657998, -79.378355]</em>, and some other properies for zooming are applied to the map.</p>
					</section>
					<section class="section-info">
						<h1 class="section-title">Backend tutorial</h1>
						<p>Lets now make a separate project folder for the backend. In root folder of application we make a new
							template:</p>
						<pre>npm init</pre>
						<p>After answering questions generated by the utility, the result will be stored in the
							<em>package.json</em>
							file in the root folder.</p>
						<pre>
							<!-- <code> -->
									{

										"name": "term-project-backend",
										"version": "0.0.1",
										"description": "",
										"main": "index.js",
										"scripts": {
										"test": "echo \"Error: no test specified\" && exit 1"
										},
										"author": "Ivan Lytovka, Dan Kotov",
										"license": "MIT"
									
									}
							<!-- </code> -->
						</pre>
						<p>Now, let's add <em>Express</em> as a project dependency into <em>package.json</em> file with following
							command:</p>
						<pre>npm install express</pre>
						<p>In <em>index.js</em> file, we import <em>express</em> and store it inside <em>app</em> variable</p>
						<pre>
							<code>
								const express = require('express')
								const app = express()
								const bodyParser = require('body-parser')
								
								app.use(bodyParser.json())
						</code>
					</pre>
						<p>Right after that, we import <em>body-parser</em> in order to retrieve raw data from HTTP requests and
							convert it into readable <em>json</em> format</p>
						<p>We now ready to define new routes for backend:</p>
						<pre>
							<code>
									let points = [
										{
										...
										},
										{
										...
										}
									]
								
								app.get('/', (req, res) => {
									res.send('&lt;h1&gt;Hello World!&lt;/h1&gt;')
								})
								
								app.get('/points', (req, res) => {
									res.json(points)
								})
								
								app.get('/points/:id', (request, response) => {
									const id = Number(request.params.id)
									const point = points.find(point => point.id === id)
									if (point) {
										response.json(point);
									}
									response.status(404).end();
								})
							</code>
						</pre>
						<p>At the moment, three routes are created. All three routes define their own event handlers for processing
							HTTP GET requests made to the endponts <em>/</em>, <em>/points</em>, and <em>/points/:id</em>.</p>
						<p>We also need to include a router that will handle POST requests. We do it as follows:</p>
						<pre>
							<code>
								app.post('/points', (request, response) => {
									const body = request.body;
								
									if (!(body.type) && !(body.latitude) && !(body.longitude)) {
										return response.status(400).json({
											error: "missing content"
										})
									}
								
									const point = {
										type: body.type,
										longitude: body.longitude,
										latitude: body.latitude,
										date: new Date(),
										id: generateId(),
									}
								
									points = points.concat(point);
									response.json(point);
								
								})
						</code>
					</pre>
						<p>The code snippet is rather straightforward. Right now, the <em>body</em> variable holds a request body
							that is
							generated by our front-end form. If some of the fields are missed, an error message is returned.
							Otherwise, a new point object is initialized and concatenated to the current set of points. Event
							handler returns a newly generated point in a <em>json</em> format.</p>
						<br>
						<p>An <em>id</em> of a brand new point is created by running the following function:</p>
						<pre>
							<code>
								const generateId = () => {
									 const maxId = points.length > 0
									  	? Math.max(...points.map(n => n.id))
										 : 0
									 return maxId + 1
								}
						</code>
					</pre>
						<p>A new <em>id</em> will be assigned based on the maximum <em>id</em> value of a current set of points.
							This ensures that two different points won't potentially have the same value for id.</p>
						<br>
						<p>The last piece of code binds the server to the <em>app</em> variable to listen to HTTP requests sent on port <em>3001</em>:</p>
						<pre>
							<code>
									const PORT = 3001
									app.listen(PORT, () => {
										console.log(`Server running on port ${PORT}`)
									})
							</code>
						</pre>
					</section>
			</div>
		</div>
	</center>


	<script src="./public/scripts/scripts.js"></script>
	<script src="./public/scripts/queries.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.0/prism.min.js"></script>
</body>

</html>